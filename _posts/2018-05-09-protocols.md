---
layout: post
title: 常用网络协议介绍 
categories: [物联网]
tags: [基础]
description: team内部培训，面向智能硬件或者物联网的同学 
---

tomorrow.cyz@gmail.com 

# 3. IP协议

IP协议提供从发起者(source)到目的地(destination)的数据传输。

IP协议的基本功能：寻址(Addressing) 和分片(fragmentation)

# 3.1 寻址

Internet协议的功能和目的是通过一个互联的网络传输数据报。

这是通过从一个internet模块到另外一个internet模块传递数据报直到目的地址来实现。

Internet模块位于主机上或者internet系统上的网关。

数据报通过基于一个internet地址的解析从一个internet模块选路到另一个internet模块。U# 3.1.1 IP地址

## 3.1.1 IP地址

区别于门牌号的地方是，这个host的ip地址可能会动态改变。(域名-->集群-->IP地址池)

IP数据报想要传递到目的地（destination），前提是必须知道目的地ip地址(dest ip addr)。

IPV4中，地址固定为4段8位的地址(32位），分为网络地址(network)和host地址(host)。IP地址的类型有三种

A类地址:第一段的最高位是0，其它7位为网络地址,剩下的24位为host地址。其中127.0.0.0~127.255.255.255为环回地址,用于本地环回测试等用途，
0.0.0.0表示当前主机。

B类地址:第一段的前两位为10，剩下的6位加上第二段共14位为网络地址，最后两段（16位）为本地地址。

C类地址:前三位为110，前三段剩下的21位为网络地址，最后一段（8位）为host地址。

D类地址：前四位为1110，前三段剩下的20位位网络地址，最后一段为host地址，一般用于组播。

E类：前四位为1111，其中255.255.255.255为全网广播地址。

>>![](/assets/media/network_ip_addr_class.jpg) 

私有地址:在IP地址的三种类型里面，都保留了一个区域作为私有地址，比如C类地址，保留了192.168.0.0 -- 192.168.255.255

## 3.1.2 子网

在IP地址分类中，同一个网络地址下面的host太多了（最少的C类地址，一个network可以有255个host），这种情况下，将它们再

分成不同的子网会更有利于管理。

比如，对于192.168.1这个网络地址，host有192.168.1.1 ---192.168.1.255 公255个host，可以分成两个子网（需要从8位host地址
额外拿出一位来做子网标识)

子网可以增加安全性，提高性能（减少广播），利于组织。

子网掩码用来分隔network地址和host地址，在子网存在的情况下，network地址包含子网标识。子网掩码就是network所占的位全部

置1，host地址所占的位位0。比如上例的子网掩码，位11111111.11111111.11111111.10000000,也就是255.255.255.128。

通过将IP地址和子网掩码进行位与计算，可以得到子网地址。

>>![](/assets/media/network_ip_subnet.jpg) 

## 3.1.2 最简单的寻址模型

最简单的寻址模型由host和route组成。

如3.1.1所述，我们知道IP地址分成网络地址和host地址,网络地址相同的host，可以互相通信。

网络地址不同的host，必须通过route。

网络地址相同的host，要通信，需要使用L2提供的能力，而L2需要Mac地址。

ARP协议解决了IP地址到Mac地址的映射问题，Host A不知道Host B的Mac地址，可以广播ARP报文，Host B收到报文需要回复自己的Mac地址。

这样Host A就知道了Host B的Mac地址，可以使用L2的功能来发送IP数据报。

如果Host C和Host A网络地址不一样，那么Host A会把报文发给路由器RouteA，RouteA需要选择一个能到达目的网络地址的路由（比如RouteX)，把IP数据报

发给它（L2的能力，Mac地址)，RouteX收到这个IP数据报，同样选择一个能到达目的网络地址的路由（这里假设RouteX可以到达RouteC)，把IP数据报发给它，RouteC收到数据报以后，

发现是自己网段的地址，发送给HostC。

在这个模型里面,host需要实现 1)判断是不是同一个网段 2) 实现ARP协议，能够将IP地址转化成Mac地址 3)  

## 3.1.3 子网


## NAT

# 3.2 分片

# 3.3 协议数据格式
